<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Claude AI - Ultra Advanced</title>
  <script src="https://js.puter.com/v2/"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  
  <!-- Highlight.js for syntax highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  
  <style>
    :root {
      --bg-base: #09090b;
      --bg-surface: #0f0f12;
      --bg-elevated: #16161a;
      --bg-hover: #1c1c21;
      --bg-active: #232329;
      
      --border-subtle: rgba(255,255,255,0.06);
      --border-default: rgba(255,255,255,0.08);
      --border-strong: rgba(255,255,255,0.12);
      
      --text-primary: #fafafa;
      --text-secondary: #a1a1aa;
      --text-muted: #71717a;
      --text-faint: #52525b;
      
      --accent-primary: #c9a87c;
      --accent-secondary: #e8d5b7;
      --accent-glow: rgba(201,168,124,0.15);
      --accent-glow-strong: rgba(201,168,124,0.3);
      
      --code-bg: #0d1117;
      --code-border: #30363d;
      
      --success: #4ade80;
      --warning: #fbbf24;
      --error: #f87171;
      --info: #60a5fa;
      --purple: #a78bfa;
      
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
      --shadow-lg: 0 8px 30px rgba(0,0,0,0.5);
      --shadow-glow: 0 0 40px var(--accent-glow);
      
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
      --radius-full: 9999px;
      
      --transition-fast: 0.15s ease;
      --transition-normal: 0.25s ease;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; overflow: hidden; }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: var(--bg-base);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    /* ===== Background ===== */
    .bg-gradient {
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events: none;
    }
    
    .bg-gradient::before {
      content: '';
      position: absolute;
      top: -40%;
      left: -20%;
      width: 80%;
      height: 80%;
      background: radial-gradient(ellipse, rgba(201,168,124,0.07) 0%, transparent 70%);
      animation: float1 25s ease-in-out infinite;
    }
    
    .bg-gradient::after {
      content: '';
      position: absolute;
      bottom: -30%;
      right: -10%;
      width: 70%;
      height: 70%;
      background: radial-gradient(ellipse, rgba(167,139,250,0.05) 0%, transparent 70%);
      animation: float2 30s ease-in-out infinite;
    }
    
    @keyframes float1 {
      0%, 100% { transform: translate(0, 0) scale(1); }
      50% { transform: translate(5%, 8%) scale(1.05); }
    }
    
    @keyframes float2 {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(-8%, -5%); }
    }

    /* ===== Layout ===== */
    .app {
      display: flex;
      height: 100%;
    }

    .main-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
    }

    /* ===== Artifacts Panel ===== */
    .artifacts-panel {
      width: 0;
      background: var(--bg-surface);
      border-left: 1px solid var(--border-subtle);
      display: flex;
      flex-direction: column;
      transition: width var(--transition-normal);
      overflow: hidden;
    }

    .artifacts-panel.open {
      width: 50%;
      min-width: 400px;
      max-width: 700px;
    }

    .artifacts-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border-subtle);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--bg-elevated);
    }

    .artifacts-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      font-weight: 600;
    }

    .artifacts-title-icon {
      width: 28px;
      height: 28px;
      border-radius: var(--radius-sm);
      background: linear-gradient(135deg, var(--purple), #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }

    .artifacts-tabs {
      display: flex;
      gap: 4px;
    }

    .artifact-tab {
      padding: 8px 14px;
      background: transparent;
      border: 1px solid transparent;
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .artifact-tab:hover {
      background: var(--bg-hover);
    }

    .artifact-tab.active {
      background: var(--bg-active);
      border-color: var(--border-default);
      color: var(--text-primary);
    }

    .artifacts-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-subtle);
      background: transparent;
      color: var(--text-muted);
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
    }

    .artifacts-close:hover {
      background: var(--error);
      border-color: var(--error);
      color: white;
    }

    .artifacts-content {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .artifact-code-view {
      flex: 1;
      overflow: auto;
      padding: 0;
      display: none;
    }

    .artifact-code-view.active {
      display: block;
    }

    .artifact-code-view pre {
      margin: 0;
      padding: 20px;
      background: var(--code-bg);
      min-height: 100%;
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      line-height: 1.6;
    }

    .artifact-preview-view {
      flex: 1;
      background: white;
      display: none;
    }

    .artifact-preview-view.active {
      display: block;
    }

    .artifact-preview-view iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .artifacts-actions {
      padding: 12px 20px;
      border-top: 1px solid var(--border-subtle);
      display: flex;
      gap: 10px;
      background: var(--bg-elevated);
    }

    .artifact-action-btn {
      flex: 1;
      padding: 10px 16px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-default);
      background: var(--bg-surface);
      color: var(--text-primary);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all var(--transition-fast);
    }

    .artifact-action-btn:hover {
      background: var(--bg-hover);
      border-color: var(--accent-primary);
    }

    .artifact-action-btn.primary {
      background: linear-gradient(135deg, var(--accent-primary), #a88a5c);
      border: none;
      color: var(--bg-base);
    }

    /* ===== Header ===== */
    .header {
      padding: 14px 20px;
      background: rgba(9,9,11,0.85);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-subtle);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand-logo {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-md);
      background: linear-gradient(135deg, var(--accent-primary), #a88a5c);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 800;
      color: var(--bg-base);
      box-shadow: var(--shadow-glow);
    }

    .brand-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .brand-name {
      font-size: 16px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--text-primary), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .brand-tag {
      font-size: 10px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .header-controls {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .mode-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-full);
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .mode-indicator .dot {
      width: 8px;
      height: 8px;
      border-radius: var(--radius-full);
      background: var(--success);
      box-shadow: 0 0 8px var(--success);
    }

    .mode-indicator.vision .dot {
      background: var(--purple);
      box-shadow: 0 0 8px var(--purple);
    }

    .model-select {
      appearance: none;
      background: var(--bg-elevated);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-md);
      padding: 10px 36px 10px 14px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-primary);
      cursor: pointer;
      outline: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2371717a' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      transition: all var(--transition-fast);
    }

    .model-select:hover {
      border-color: var(--border-strong);
    }

    .model-select:focus {
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px var(--accent-glow);
    }

    .model-select option {
      background: var(--bg-elevated);
    }

    .new-chat-btn {
      padding: 10px 16px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-md);
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all var(--transition-fast);
    }

    .new-chat-btn:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
      border-color: var(--accent-primary);
    }

    /* ===== Chat ===== */
    .chat-container {
      flex: 1;
      overflow-y: auto;
      padding: 24px 20px;
      max-width: 900px;
      margin: 0 auto;
      width: 100%;
    }

    .chat-container::-webkit-scrollbar { width: 6px; }
    .chat-container::-webkit-scrollbar-track { background: transparent; }
    .chat-container::-webkit-scrollbar-thumb {
      background: var(--border-default);
      border-radius: var(--radius-full);
    }

    /* ===== Welcome ===== */
    .welcome {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 60px 20px;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .welcome-icon {
      width: 80px;
      height: 80px;
      border-radius: var(--radius-xl);
      background: linear-gradient(135deg, var(--accent-primary), #a88a5c);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 38px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-glow), var(--shadow-lg);
      animation: pulse 3s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { box-shadow: var(--shadow-glow), var(--shadow-lg); }
      50% { box-shadow: 0 0 50px var(--accent-glow-strong), var(--shadow-lg); }
    }

    .welcome-title {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 10px;
      background: linear-gradient(135deg, var(--text-primary), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .welcome-subtitle {
      font-size: 15px;
      color: var(--text-secondary);
      max-width: 480px;
      line-height: 1.7;
      margin-bottom: 36px;
    }

    .welcome-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 14px;
      width: 100%;
      max-width: 560px;
    }

    .welcome-card {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: 18px;
      text-align: left;
      cursor: pointer;
      transition: all var(--transition-normal);
    }

    .welcome-card:hover {
      border-color: var(--accent-primary);
      transform: translateY(-3px);
      box-shadow: var(--shadow-md), 0 0 25px var(--accent-glow);
    }

    .welcome-card-icon {
      font-size: 24px;
      margin-bottom: 10px;
    }

    .welcome-card-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .welcome-card-desc {
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    /* ===== Messages ===== */
    .message {
      display: flex;
      gap: 14px;
      margin-bottom: 24px;
      animation: msgIn 0.35s ease;
    }

    @keyframes msgIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .message-avatar {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 700;
      flex-shrink: 0;
    }

    .message-avatar.user {
      background: var(--bg-elevated);
      border: 1px solid var(--border-default);
      color: var(--text-secondary);
    }

    .message-avatar.assistant {
      background: linear-gradient(135deg, var(--accent-primary), #a88a5c);
      color: var(--bg-base);
      box-shadow: 0 0 15px var(--accent-glow);
    }

    .message-body {
      flex: 1;
      min-width: 0;
    }

    .message-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
    }

    .message-name {
      font-size: 13px;
      font-weight: 600;
    }

    .message-time {
      font-size: 11px;
      color: var(--text-faint);
    }

    .message-content {
      font-size: 14px;
      line-height: 1.75;
    }

    .message-content strong {
      color: var(--accent-secondary);
    }

    .message-content p {
      margin-bottom: 12px;
    }

    .message-content p:last-child {
      margin-bottom: 0;
    }

    .message-content code:not(pre code) {
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      padding: 2px 7px;
      border-radius: var(--radius-sm);
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      color: #f0abfc;
    }

    .message-content pre {
      margin: 14px 0;
      border-radius: var(--radius-md);
      overflow: hidden;
      border: 1px solid var(--code-border);
    }

    .message-content pre code {
      display: block;
      padding: 16px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      line-height: 1.6;
      overflow-x: auto;
    }

    .message-images {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 12px;
    }

    .message-image {
      max-width: 260px;
      max-height: 260px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-default);
      cursor: pointer;
      transition: all var(--transition-fast);
      object-fit: cover;
    }

    .message-image:hover {
      border-color: var(--accent-primary);
      transform: scale(1.02);
    }

    /* Artifact in message */
    .message-artifact {
      margin: 14px 0;
      background: var(--bg-surface);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .message-artifact-header {
      padding: 12px 16px;
      background: var(--bg-elevated);
      border-bottom: 1px solid var(--border-subtle);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .message-artifact-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      font-weight: 600;
    }

    .message-artifact-title-icon {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      background: linear-gradient(135deg, var(--purple), #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }

    .message-artifact-actions {
      display: flex;
      gap: 8px;
    }

    .message-artifact-btn {
      padding: 6px 12px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all var(--transition-fast);
    }

    .message-artifact-btn:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .message-artifact-preview {
      height: 200px;
      background: white;
      position: relative;
    }

    .message-artifact-preview iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .message-artifact-expand {
      position: absolute;
      bottom: 10px;
      right: 10px;
      padding: 8px 14px;
      background: var(--bg-base);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all var(--transition-fast);
    }

    .message-artifact-expand:hover {
      background: var(--accent-primary);
      color: var(--bg-base);
    }

    /* Typing */
    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .typing-dots {
      display: flex;
      gap: 4px;
    }

    .typing-dots span {
      width: 7px;
      height: 7px;
      background: var(--accent-primary);
      border-radius: var(--radius-full);
      animation: typeBounce 1.2s ease-in-out infinite;
    }

    .typing-dots span:nth-child(2) { animation-delay: 0.15s; }
    .typing-dots span:nth-child(3) { animation-delay: 0.3s; }

    @keyframes typeBounce {
      0%, 60%, 100% { transform: translateY(0); opacity: 0.5; }
      30% { transform: translateY(-6px); opacity: 1; }
    }

    .typing-text {
      font-size: 13px;
      color: var(--text-muted);
    }

    /* ===== Composer ===== */
    .composer {
      padding: 16px 20px 20px;
      background: linear-gradient(to top, var(--bg-base) 70%, transparent);
      max-width: 900px;
      margin: 0 auto;
      width: 100%;
    }

    .composer-box {
      background: var(--bg-surface);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-xl);
      padding: 14px;
      transition: all var(--transition-fast);
      box-shadow: var(--shadow-lg);
    }

    .composer-box:focus-within {
      border-color: var(--accent-primary);
      box-shadow: var(--shadow-lg), 0 0 0 3px var(--accent-glow);
    }

    .preview-area {
      display: none;
      flex-wrap: wrap;
      gap: 10px;
      padding-bottom: 14px;
      margin-bottom: 14px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .preview-area.active {
      display: flex;
    }

    .preview-item {
      position: relative;
      width: 72px;
      height: 72px;
      border-radius: var(--radius-md);
      overflow: hidden;
      border: 2px solid var(--border-default);
    }

    .preview-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .preview-remove {
      position: absolute;
      top: -7px;
      right: -7px;
      width: 22px;
      height: 22px;
      border-radius: var(--radius-full);
      background: var(--error);
      border: 2px solid var(--bg-surface);
      color: white;
      font-size: 11px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .input-row {
      display: flex;
      align-items: flex-end;
      gap: 10px;
    }

    .text-input {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: var(--text-primary);
      font-size: 14px;
      font-family: inherit;
      line-height: 1.5;
      resize: none;
      min-height: 24px;
      max-height: 180px;
    }

    .text-input::placeholder {
      color: var(--text-faint);
    }

    .input-actions {
      display: flex;
      gap: 8px;
    }

    .action-btn {
      width: 42px;
      height: 42px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-default);
      background: var(--bg-elevated);
      color: var(--text-secondary);
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
    }

    .action-btn:hover {
      border-color: var(--accent-primary);
      color: var(--accent-primary);
    }

    .send-btn {
      width: 42px;
      height: 42px;
      border-radius: var(--radius-md);
      border: none;
      background: linear-gradient(135deg, var(--accent-primary), #a88a5c);
      color: var(--bg-base);
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
      box-shadow: 0 4px 12px var(--accent-glow);
    }

    .send-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px var(--accent-glow-strong);
    }

    .send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* ===== Hidden ===== */
    #fileInput { display: none; }

    /* ===== Drop Overlay ===== */
    .drop-overlay {
      position: fixed;
      inset: 0;
      z-index: 500;
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 14px;
      background: rgba(9,9,11,0.95);
      border: 3px dashed var(--accent-primary);
    }

    .drop-overlay.active {
      display: flex;
    }

    .drop-icon {
      font-size: 64px;
      animation: dropFloat 1s ease-in-out infinite;
    }

    @keyframes dropFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-12px); }
    }

    .drop-text {
      font-size: 20px;
      font-weight: 600;
    }

    /* ===== Modal ===== */
    .modal {
      position: fixed;
      inset: 0;
      z-index: 600;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.92);
      padding: 40px;
    }

    .modal.active {
      display: flex;
    }

    .modal img {
      max-width: 100%;
      max-height: 100%;
      border-radius: var(--radius-lg);
      object-fit: contain;
    }

    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 46px;
      height: 46px;
      border-radius: var(--radius-full);
      border: 1px solid var(--border-default);
      background: var(--bg-elevated);
      color: var(--text-primary);
      font-size: 22px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-close:hover {
      background: var(--error);
      border-color: var(--error);
    }

    /* ===== Toast ===== */
    .toast {
      position: fixed;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: var(--bg-elevated);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-lg);
      padding: 12px 22px;
      font-size: 13px;
      font-weight: 500;
      box-shadow: var(--shadow-lg);
      opacity: 0;
      pointer-events: none;
      transition: all var(--transition-normal);
      z-index: 700;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* ===== Responsive ===== */
    @media (max-width: 900px) {
      .artifacts-panel.open {
        position: fixed;
        inset: 0;
        width: 100%;
        max-width: none;
        z-index: 400;
      }
      
      .brand-info { display: none; }
      .mode-indicator span { display: none; }
    }
  </style>
</head>

<body>
  <div class="bg-gradient"></div>

  <div class="app">
    <!-- Main Panel -->
    <div class="main-panel">
      <!-- Header -->
      <header class="header">
        <div class="brand">
          <div class="brand-logo">‚ú¶</div>
          <div class="brand-info">
            <div class="brand-name">Claude AI</div>
            <div class="brand-tag">Ultra Advanced</div>
          </div>
        </div>
        
        <div class="header-controls">
          <div class="mode-indicator" id="modeIndicator">
            <span class="dot"></span>
            <span>Chat</span>
          </div>
          
          <select class="model-select" id="modelSelect">
            <option value="claude-opus-4-5">Claude Opus 4.5</option>
            <option value="claude-sonnet-4-5" selected>Claude Sonnet 4.5</option>
            <option value="claude-haiku-4-5">Claude Haiku 4.5</option>
            <option value="gpt-4o">GPT-4o (Backup)</option>
          </select>
          
          <button class="new-chat-btn" id="newChatBtn">
            <span>+</span> New
          </button>
        </div>
      </header>

      <!-- Chat -->
      <div class="chat-container" id="chatContainer">
        <div class="welcome" id="welcome">
          <div class="welcome-icon">‚ú¶</div>
          <h1 class="welcome-title">How can I help you?</h1>
          <p class="welcome-subtitle">
            I can analyze images, write code with live previews, answer questions, and much more.
          </p>
          <div class="welcome-grid">
            <div class="welcome-card" onclick="triggerUpload()">
              <div class="welcome-card-icon">üñºÔ∏è</div>
              <div class="welcome-card-title">Analyze Image</div>
              <div class="welcome-card-desc">Ultra detailed vision</div>
            </div>
            <div class="welcome-card" onclick="setPrompt('Create a beautiful landing page with HTML, CSS, and JS')">
              <div class="welcome-card-icon">üíª</div>
              <div class="welcome-card-title">Write Code</div>
              <div class="welcome-card-desc">With live preview</div>
            </div>
            <div class="welcome-card" onclick="setPrompt('Explain quantum computing simply')">
              <div class="welcome-card-icon">üß†</div>
              <div class="welcome-card-title">Explain Anything</div>
              <div class="welcome-card-desc">Clear explanations</div>
            </div>
            <div class="welcome-card" onclick="setPrompt('Help me brainstorm ideas for a mobile app')">
              <div class="welcome-card-icon">üí°</div>
              <div class="welcome-card-title">Brainstorm</div>
              <div class="welcome-card-desc">Creative ideas</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Composer -->
      <div class="composer">
        <div class="composer-box">
          <div class="preview-area" id="previewArea"></div>
          
          <div class="input-row">
            <textarea 
              class="text-input" 
              id="textInput" 
              placeholder="Message Claude..."
              rows="1"
            ></textarea>
            <div class="input-actions">
              <button class="action-btn" id="imageBtn" title="Upload Image">üì∑</button>
              <button class="send-btn" id="sendBtn" title="Send">‚û§</button>
            </div>
          </div>
        </div>
      </div>

      <input type="file" id="fileInput" accept="image/*" />
    </div>

    <!-- Artifacts Panel -->
    <div class="artifacts-panel" id="artifactsPanel">
      <div class="artifacts-header">
        <div class="artifacts-title">
          <span class="artifacts-title-icon">‚ö°</span>
          <span id="artifactName">Artifact</span>
        </div>
        <div class="artifacts-tabs">
          <button class="artifact-tab active" data-view="code" onclick="switchArtifactView('code')">Code</button>
          <button class="artifact-tab" data-view="preview" onclick="switchArtifactView('preview')">Preview</button>
        </div>
        <button class="artifacts-close" onclick="closeArtifacts()">√ó</button>
      </div>
      <div class="artifacts-content">
        <div class="artifact-code-view active" id="artifactCodeView">
          <pre><code id="artifactCode"></code></pre>
        </div>
        <div class="artifact-preview-view" id="artifactPreviewView">
          <iframe id="artifactPreviewFrame" sandbox="allow-scripts"></iframe>
        </div>
      </div>
      <div class="artifacts-actions">
        <button class="artifact-action-btn" onclick="copyArtifact()">üìã Copy Code</button>
        <button class="artifact-action-btn" onclick="downloadArtifact()">üíæ Download</button>
        <button class="artifact-action-btn primary" onclick="openInNewTab()">üöÄ Open in New Tab</button>
      </div>
    </div>
  </div>

  <!-- Overlays -->
  <div class="drop-overlay" id="dropOverlay">
    <div class="drop-icon">üì∑</div>
    <div class="drop-text">Drop image here</div>
  </div>

  <div class="modal" id="imageModal">
    <button class="modal-close" onclick="closeModal()">√ó</button>
    <img id="modalImage" />
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ==================== STATE ====================
    const state = {
      pendingFile: null,
      pendingPreviewUrl: null,
      currentArtifact: null,
      conversationHistory: [],
      busy: false
    };

    // ==================== ELEMENTS ====================
    const chatContainer = document.getElementById('chatContainer');
    const welcomeEl = document.getElementById('welcome');
    const previewArea = document.getElementById('previewArea');
    const textInput = document.getElementById('textInput');
    const imageBtn = document.getElementById('imageBtn');
    const sendBtn = document.getElementById('sendBtn');
    const fileInput = document.getElementById('fileInput');
    const modelSelect = document.getElementById('modelSelect');
    const modeIndicator = document.getElementById('modeIndicator');
    const newChatBtn = document.getElementById('newChatBtn');
    const dropOverlay = document.getElementById('dropOverlay');
    const imageModal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    const toast = document.getElementById('toast');
    
    // Artifacts
    const artifactsPanel = document.getElementById('artifactsPanel');
    const artifactName = document.getElementById('artifactName');
    const artifactCode = document.getElementById('artifactCode');
    const artifactCodeView = document.getElementById('artifactCodeView');
    const artifactPreviewView = document.getElementById('artifactPreviewView');
    const artifactPreviewFrame = document.getElementById('artifactPreviewFrame');

    // ==================== PROMPTS ====================
    const VISION_PROMPT = `You are an ultra-advanced vision AI. Analyze images with extreme precision.

OUTPUT FORMAT:
## üéØ Identification
[What this is]

## üîç Detailed Analysis
[Bullet points of everything observed]

## üìù Text Found
[Any text in the image]

## üí° Key Insights
[Notable observations]

Be thorough and precise.`;

    const CODE_PROMPT = `You are an elite coding assistant. When writing code:
1. Always provide complete, working code
2. Use modern best practices
3. Include helpful comments
4. Make it beautiful and functional

When creating HTML/CSS/JS, wrap your code in a special artifact block like this:
\`\`\`artifact:html
<!DOCTYPE html>
<html>
...complete code here...
</html>
\`\`\`

This will create a live preview for the user.`;

    // ==================== UTILITIES ====================
    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2500);
    }

    function updateMode(mode) {
      modeIndicator.className = 'mode-indicator' + (mode === 'vision' ? ' vision' : '');
      modeIndicator.querySelector('span:last-child').textContent = mode === 'vision' ? 'Vision' : 'Chat';
    }

    function autoResize() {
      textInput.style.height = 'auto';
      textInput.style.height = Math.min(textInput.scrollHeight, 180) + 'px';
    }

    function escapeHtml(str) {
      return (str || '').replace(/[&<>"']/g, c => ({
        '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
      }[c]));
    }

    function getTime() {
      return new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    // ==================== MARKDOWN + ARTIFACTS ====================
    function parseAndRender(text) {
      let html = '';
      let remaining = text;
      
      // Extract artifacts
      const artifactRegex = /```artifact:(\w+)\n([\s\S]*?)```/g;
      let match;
      let lastIndex = 0;
      
      while ((match = artifactRegex.exec(text)) !== null) {
        // Add text before artifact
        const before = text.slice(lastIndex, match.index);
        html += formatMarkdown(before);
        
        // Add artifact
        const type = match[1];
        const code = match[2].trim();
        
        state.currentArtifact = { type, code, name: `${type.toUpperCase()} Code` };
        
        html += `
          <div class="message-artifact">
            <div class="message-artifact-header">
              <div class="message-artifact-title">
                <span class="message-artifact-title-icon">‚ö°</span>
                <span>${type.toUpperCase()} Artifact</span>
              </div>
              <div class="message-artifact-actions">
                <button class="message-artifact-btn" onclick="copyArtifact()">üìã Copy</button>
                <button class="message-artifact-btn" onclick="openArtifacts()">üîç Expand</button>
              </div>
            </div>
            <div class="message-artifact-preview">
              <iframe id="inlinePreview" sandbox="allow-scripts" srcdoc="${escapeHtml(code)}"></iframe>
              <button class="message-artifact-expand" onclick="openArtifacts()">‚õ∂ Full View</button>
            </div>
          </div>
        `;
        
        lastIndex = match.index + match[0].length;
      }
      
      // Add remaining text
      if (lastIndex < text.length) {
        html += formatMarkdown(text.slice(lastIndex));
      }
      
      return html || formatMarkdown(text);
    }

    function formatMarkdown(text) {
      if (!text) return '';
      
      let t = escapeHtml(text);
      
      // Headers
      t = t.replace(/^### (.*$)/gm, '<strong style="color:var(--accent-secondary);display:block;margin:16px 0 8px;">$1</strong>');
      t = t.replace(/^## (.*$)/gm, '<strong style="color:var(--accent-secondary);font-size:16px;display:block;margin:18px 0 10px;">$1</strong>');
      t = t.replace(/^# (.*$)/gm, '<strong style="color:var(--accent-secondary);font-size:18px;display:block;margin:20px 0 12px;">$1</strong>');
      
      // Code blocks (not artifacts)
      t = t.replace(/```(\w*)\n([\s\S]*?)```/g, (match, lang, code) => {
        const highlighted = hljs.highlightAuto(code.trim()).value;
        return `<pre><code class="hljs">${highlighted}</code></pre>`;
      });
      
      // Inline code
      t = t.replace(/`([^`]+)`/g, '<code>$1</code>');
      
      // Bold
      t = t.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
      
      // Italic
      t = t.replace(/\*(.*?)\*/g, '<em>$1</em>');
      
      // Lists
      t = t.replace(/^- (.*$)/gm, '‚Ä¢ $1');
      
      // Line breaks
      t = t.replace(/\n/g, '<br>');
      
      return t;
    }

    // ==================== ARTIFACTS PANEL ====================
    function openArtifacts() {
      if (!state.currentArtifact) return;
      
      artifactName.textContent = state.currentArtifact.name;
      artifactCode.textContent = state.currentArtifact.code;
      hljs.highlightElement(artifactCode);
      
      if (state.currentArtifact.type === 'html') {
        artifactPreviewFrame.srcdoc = state.currentArtifact.code;
      }
      
      artifactsPanel.classList.add('open');
    }

    function closeArtifacts() {
      artifactsPanel.classList.remove('open');
    }

    function switchArtifactView(view) {
      document.querySelectorAll('.artifact-tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`.artifact-tab[data-view="${view}"]`).classList.add('active');
      
      artifactCodeView.classList.toggle('active', view === 'code');
      artifactPreviewView.classList.toggle('active', view === 'preview');
    }

    function copyArtifact() {
      if (!state.currentArtifact) return;
      navigator.clipboard.writeText(state.currentArtifact.code);
      showToast('Code copied!');
    }

    function downloadArtifact() {
      if (!state.currentArtifact) return;
      const ext = state.currentArtifact.type === 'html' ? 'html' : state.currentArtifact.type;
      const blob = new Blob([state.currentArtifact.code], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `artifact.${ext}`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('Downloaded!');
    }

    function openInNewTab() {
      if (!state.currentArtifact) return;
      const win = window.open('', '_blank');
      win.document.write(state.currentArtifact.code);
      win.document.close();
    }

    // ==================== IMAGE PROCESSING ====================
    async function fileToDataUrl(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = () => reject(new Error('Failed to read file'));
        reader.readAsDataURL(file);
      });
    }

    async function fileToBitmap(file) {
      try {
        return await createImageBitmap(file, { imageOrientation: 'from-image' });
      } catch {
        const url = await fileToDataUrl(file);
        return new Promise((resolve, reject) => {
          const img = new Image();
          img.onload = () => resolve(img);
          img.onerror = () => reject(new Error('Failed'));
          img.src = url;
        });
      }
    }

    function canvasToJpeg(canvas, q = 0.95) {
      return canvas.toDataURL('image/jpeg', q);
    }

    function resizeCanvas(drawable, max = 2400) {
      const scale = Math.min(1, max / Math.max(drawable.width, drawable.height));
      const w = Math.round(drawable.width * scale);
      const h = Math.round(drawable.height * scale);
      const c = document.createElement('canvas');
      c.width = w; c.height = h;
      const ctx = c.getContext('2d', { alpha: false });
      ctx.imageSmoothingEnabled = true;
      ctx.imageSmoothingQuality = 'high';
      ctx.drawImage(drawable, 0, 0, w, h);
      return c;
    }

    function cropCanvas(src, x, y, w, h) {
      const c = document.createElement('canvas');
      c.width = w; c.height = h;
      const ctx = c.getContext('2d', { alpha: false });
      ctx.drawImage(src, x, y, w, h, 0, 0, w, h);
      return canvasToJpeg(c, 0.95);
    }

    async function buildVisionPack(file) {
      const bmp = await fileToBitmap(file);
      const base = resizeCanvas(bmp, 2400);
      const full = canvasToJpeg(base, 0.95);
      
      const W = base.width, H = base.height;
      const hW = Math.floor(W/2), hH = Math.floor(H/2);
      
      const crops = [
        { label: 'TOP-LEFT', data: cropCanvas(base, 0, 0, hW, hH) },
        { label: 'TOP-RIGHT', data: cropCanvas(base, hW, 0, W-hW, hH) },
        { label: 'BOTTOM-LEFT', data: cropCanvas(base, 0, hH, hW, H-hH) },
        { label: 'BOTTOM-RIGHT', data: cropCanvas(base, hW, hH, W-hW, H-hH) },
        { label: 'CENTER', data: cropCanvas(base, Math.floor(W*0.25), Math.floor(H*0.25), Math.floor(W*0.5), Math.floor(H*0.5)) }
      ];
      
      return { full, crops, displayUrl: URL.createObjectURL(file) };
    }

    function dataUrlToParts(url) {
      const m = url.match(/^data:(image\/[a-zA-Z0-9.+-]+);base64,(.+)$/);
      if (!m) throw new Error('Invalid');
      return { media_type: m[1], data: m[2] };
    }

    function makeImageBlock(url) {
      const { media_type, data } = dataUrlToParts(url);
      return { type: 'image', source: { type: 'base64', media_type, data } };
    }

    // ==================== CHAT UI ====================
    function addMessage({ role, text, images = [] }) {
      welcomeEl.style.display = 'none';
      
      const msg = document.createElement('div');
      msg.className = 'message';
      
      const isAssistant = role === 'assistant';
      
      let imagesHtml = '';
      if (images.length) {
        imagesHtml = `<div class="message-images">
          ${images.map(u => `<img src="${u}" class="message-image" onclick="openImageModal('${u}')" />`).join('')}
        </div>`;
      }
      
      msg.innerHTML = `
        <div class="message-avatar ${role}">${isAssistant ? '‚ú¶' : 'üë§'}</div>
        <div class="message-body">
          <div class="message-header">
            <span class="message-name">${isAssistant ? 'Claude' : 'You'}</span>
            <span class="message-time">${getTime()}</span>
          </div>
          ${imagesHtml}
          <div class="message-content"></div>
        </div>
      `;
      
      chatContainer.appendChild(msg);
      chatContainer.scrollTop = chatContainer.scrollHeight;
      
      return msg.querySelector('.message-content');
    }

    function addTyping() {
      welcomeEl.style.display = 'none';
      
      const msg = document.createElement('div');
      msg.className = 'message';
      msg.id = 'typingMsg';
      msg.innerHTML = `
        <div class="message-avatar assistant">‚ú¶</div>
        <div class="message-body">
          <div class="message-header">
            <span class="message-name">Claude</span>
          </div>
          <div class="typing-indicator">
            <div class="typing-dots"><span></span><span></span><span></span></div>
            <span class="typing-text">Thinking...</span>
          </div>
        </div>
      `;
      chatContainer.appendChild(msg);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function removeTyping() {
      document.getElementById('typingMsg')?.remove();
    }

    // ==================== PREVIEW ====================
    function renderPreview() {
      if (state.pendingPreviewUrl) {
        URL.revokeObjectURL(state.pendingPreviewUrl);
        state.pendingPreviewUrl = null;
      }
      
      previewArea.innerHTML = '';
      
      if (!state.pendingFile) {
        previewArea.classList.remove('active');
        updateMode('chat');
        return;
      }
      
      previewArea.classList.add('active');
      updateMode('vision');
      
      const url = URL.createObjectURL(state.pendingFile);
      state.pendingPreviewUrl = url;
      
      previewArea.innerHTML = `
        <div class="preview-item">
          <img src="${url}" onclick="openImageModal('${url}')" />
          <button class="preview-remove" onclick="removeImage()">√ó</button>
        </div>
      `;
    }

    function removeImage() {
      state.pendingFile = null;
      renderPreview();
    }

    // ==================== API CALLS ====================
    async function callVision({ model, userText, pack }) {
      const blocks = [];
      
      blocks.push({ type: 'text', text: '[FULL IMAGE]' });
      blocks.push(makeImageBlock(pack.full));
      
      for (const crop of pack.crops) {
        blocks.push({ type: 'text', text: `[CROP: ${crop.label}]` });
        blocks.push(makeImageBlock(crop.data));
      }
      
      const prompt = `${VISION_PROMPT}\n\n---\n\nUSER: ${userText || 'Analyze this image thoroughly.'}`;
      blocks.push({ type: 'text', text: prompt });
      
      return await puter.ai.chat([{ role: 'user', content: blocks }], { model, stream: true });
    }

    async function callChat({ model, userText }) {
      state.conversationHistory.push({ role: 'user', content: userText });
      
      const systemMsg = { role: 'user', content: CODE_PROMPT };
      const messages = [systemMsg, ...state.conversationHistory.slice(-20)];
      
      return await puter.ai.chat(messages, { model, stream: true });
    }

    // ==================== SEND ====================
    async function send() {
      if (state.busy) return;
      
      const userText = textInput.value.trim();
      const hasImage = !!state.pendingFile;
      
      if (!userText && !hasImage) return;
      
      state.busy = true;
      sendBtn.disabled = true;
      
      try {
        let pack = null;
        let displayUrl = null;
        
        // If there's an image, process it (ONE TIME ONLY)
        if (hasImage) {
          pack = await buildVisionPack(state.pendingFile);
          displayUrl = pack.displayUrl;
          
          // CLEAR the image after use!
          state.pendingFile = null;
          renderPreview();
        }
        
        // Show user message
        addMessage({
          role: 'user',
          text: userText || 'Analyze this image.',
          images: displayUrl ? [displayUrl] : []
        });
        
        textInput.value = '';
        autoResize();
        
        addTyping();
        
        const model = modelSelect.value;
        
        // Call appropriate API
        let stream;
        if (pack) {
          stream = await callVision({ model, userText, pack });
        } else {
          stream = await callChat({ model, userText });
        }
        
        removeTyping();
        
        const contentEl = addMessage({ role: 'assistant', text: '' });
        let fullText = '';
        
        for await (const part of stream) {
          if (part?.text) {
            fullText += part.text;
            contentEl.innerHTML = parseAndRender(fullText);
            chatContainer.scrollTop = chatContainer.scrollHeight;
          }
        }
        
        // Add to history for context (text only, not images)
        if (!pack) {
          state.conversationHistory.push({ role: 'assistant', content: fullText });
        }
        
        if (!fullText.trim()) {
          contentEl.innerHTML = '<em style="color:var(--text-muted)">No response received. Try again.</em>';
        }
        
      } catch (err) {
        removeTyping();
        addMessage({
          role: 'assistant',
          text: `‚ùå Error: ${err?.message || err}\n\nTry switching models.`
        });
        console.error(err);
      } finally {
        state.busy = false;
        sendBtn.disabled = false;
        textInput.focus();
      }
    }

    // ==================== HELPERS ====================
    function triggerUpload() {
      fileInput.click();
    }

    function setPrompt(text) {
      textInput.value = text;
      autoResize();
      textInput.focus();
    }

    function openImageModal(src) {
      modalImage.src = src;
      imageModal.classList.add('active');
    }

    function closeModal() {
      imageModal.classList.remove('active');
    }

    function newChat() {
      state.conversationHistory = [];
      state.currentArtifact = null;
      state.pendingFile = null;
      renderPreview();
      closeArtifacts();
      
      chatContainer.innerHTML = '';
      chatContainer.appendChild(welcomeEl);
      welcomeEl.style.display = '';
      
      showToast('New chat started');
    }

    // ==================== EVENTS ====================
    imageBtn.addEventListener('click', triggerUpload);
    
    fileInput.addEventListener('change', (e) => {
      const file = e.target.files?.[0];
      if (file?.type.startsWith('image/')) {
        state.pendingFile = file;
        renderPreview();
        showToast('Image ready!');
      }
      fileInput.value = '';
    });
    
    sendBtn.addEventListener('click', send);
    newChatBtn.addEventListener('click', newChat);
    
    textInput.addEventListener('input', autoResize);
    textInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        send();
      }
    });
    
    // Paste
    document.addEventListener('paste', (e) => {
      const item = Array.from(e.clipboardData?.items || []).find(i => i.type.startsWith('image/'));
      if (item) {
        e.preventDefault();
        state.pendingFile = item.getAsFile();
        renderPreview();
        showToast('Image pasted!');
      }
    });
    
    // Drag & Drop
    let dragCounter = 0;
    document.addEventListener('dragenter', (e) => { e.preventDefault(); dragCounter++; dropOverlay.classList.add('active'); });
    document.addEventListener('dragover', (e) => e.preventDefault());
    document.addEventListener('dragleave', (e) => { e.preventDefault(); if (--dragCounter <= 0) dropOverlay.classList.remove('active'); });
    document.addEventListener('drop', (e) => {
      e.preventDefault();
      dragCounter = 0;
      dropOverlay.classList.remove('active');
      const file = e.dataTransfer?.files?.[0];
      if (file?.type.startsWith('image/')) {
        state.pendingFile = file;
        renderPreview();
        showToast('Image dropped!');
      }
    });
    
    // Modal
    imageModal.addEventListener('click', (e) => { if (e.target === imageModal) closeModal(); });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeModal(); closeArtifacts(); } });
    
    // Init
    textInput.focus();
  </script>
</body>
</html>
