<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî¨ Ultra Vision AI - Advanced Image Analysis</title>
    <script src="https://js.puter.com/v2/"></script>
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --bg-card: #1e1e2a;
            --accent: #6366f1;
            --accent-glow: rgba(99, 102, 241, 0.4);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --text-muted: #606070;
            --border: rgba(255,255,255,0.08);
            --border-accent: rgba(99, 102, 241, 0.3);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }
        .bg-animation::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 20% 80%, rgba(99, 102, 241, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, rgba(16, 185, 129, 0.05) 0%, transparent 40%);
            animation: bgMove 20s ease-in-out infinite;
        }
        @keyframes bgMove {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(2%, 2%) rotate(1deg); }
            66% { transform: translate(-1%, 1%) rotate(-1deg); }
        }

        /* Header */
        .header {
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 700;
        }
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        .header-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        .model-select {
            padding: 10px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
            outline: none;
            transition: all 0.2s;
        }
        .model-select:hover {
            border-color: var(--accent);
        }
        .model-select option {
            background: var(--bg-secondary);
        }
        .header-btn {
            padding: 10px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }
        .header-btn:hover {
            background: var(--accent);
            border-color: var(--accent);
        }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 320px 1fr 380px;
            height: calc(100vh - 65px);
        }

        /* Left Panel - Upload & Tools */
        .left-panel {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-section {
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }
        .panel-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        .panel-section-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-muted);
        }

        /* Upload Zone */
        .upload-zone {
            border: 2px dashed var(--border);
            border-radius: 16px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255,255,255,0.02);
            position: relative;
            overflow: hidden;
        }
        .upload-zone::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--accent-glow), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .upload-zone:hover, .upload-zone.dragover {
            border-color: var(--accent);
            transform: scale(1.01);
        }
        .upload-zone:hover::before, .upload-zone.dragover::before {
            opacity: 1;
        }
        .upload-icon {
            font-size: 48px;
            margin-bottom: 12px;
            position: relative;
        }
        .upload-text {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            position: relative;
        }
        .upload-subtext {
            font-size: 11px;
            color: var(--text-muted);
            position: relative;
        }
        .upload-methods {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            position: relative;
        }
        .upload-method-btn {
            flex: 1;
            padding: 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        .upload-method-btn:hover {
            background: var(--accent);
            border-color: var(--accent);
        }

        /* URL Input */
        .url-input-container {
            display: none;
            margin-top: 12px;
            position: relative;
        }
        .url-input-container.active {
            display: block;
        }
        .url-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 13px;
            outline: none;
        }
        .url-input:focus {
            border-color: var(--accent);
        }
        .url-submit {
            position: absolute;
            right: 6px;
            top: 50%;
            transform: translateY(-50%);
            padding: 8px 16px;
            background: var(--accent);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 12px;
        }

        /* Analysis Modes Grid */
        .modes-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        .mode-btn {
            padding: 14px 8px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            font-size: 11px;
        }
        .mode-btn:hover {
            background: rgba(99, 102, 241, 0.1);
            border-color: var(--border-accent);
            color: var(--text-primary);
        }
        .mode-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
            box-shadow: 0 4px 20px var(--accent-glow);
        }
        .mode-btn-icon {
            font-size: 20px;
            display: block;
            margin-bottom: 6px;
        }

        /* Image Queue */
        .image-queue {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }
        .queue-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }
        .queue-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 2px solid transparent;
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .queue-item:hover {
            background: rgba(99, 102, 241, 0.08);
        }
        .queue-item.selected {
            border-color: var(--accent);
            background: rgba(99, 102, 241, 0.12);
        }
        .queue-item-thumb {
            width: 56px;
            height: 56px;
            border-radius: 10px;
            object-fit: cover;
        }
        .queue-item-info {
            flex: 1;
            min-width: 0;
        }
        .queue-item-name {
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 4px;
        }
        .queue-item-meta {
            font-size: 11px;
            color: var(--text-muted);
        }
        .queue-item-status {
            font-size: 10px;
            padding: 4px 8px;
            border-radius: 6px;
            background: var(--bg-secondary);
        }
        .queue-item-status.analyzed {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }
        .queue-item-remove {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s;
            font-size: 16px;
        }
        .queue-item-remove:hover {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        /* Center Panel - Image Viewer */
        .center-panel {
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
            overflow: hidden;
        }

        /* Image Viewer */
        .image-viewer {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: 
                radial-gradient(circle at center, rgba(99, 102, 241, 0.03) 0%, transparent 70%),
                repeating-linear-gradient(0deg, transparent, transparent 20px, rgba(255,255,255,0.02) 20px, rgba(255,255,255,0.02) 21px),
                repeating-linear-gradient(90deg, transparent, transparent 20px, rgba(255,255,255,0.02) 20px, rgba(255,255,255,0.02) 21px);
            overflow: hidden;
        }
        .viewer-placeholder {
            text-align: center;
            color: var(--text-muted);
        }
        .viewer-placeholder-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        .viewer-placeholder-text {
            font-size: 16px;
            margin-bottom: 8px;
        }
        .viewer-placeholder-hint {
            font-size: 13px;
            opacity: 0.7;
        }

        .main-image-container {
            position: relative;
            display: none;
            max-width: 100%;
            max-height: 100%;
        }
        .main-image-container.active {
            display: block;
        }
        #mainImage {
            max-width: 100%;
            max-height: calc(100vh - 250px);
            object-fit: contain;
            border-radius: 8px;
            transition: transform 0.2s, filter 0.2s;
        }

        /* Image Toolbar */
        .image-toolbar {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            gap: 6px;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(20px);
            padding: 10px 14px;
            border-radius: 14px;
            border: 1px solid var(--border);
        }
        .image-toolbar.active {
            display: flex;
        }
        .toolbar-btn {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.08);
            border: none;
            border-radius: 10px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .toolbar-btn:hover {
            background: var(--accent);
        }
        .toolbar-separator {
            width: 1px;
            background: var(--border);
            margin: 0 6px;
        }
        .toolbar-zoom {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 10px;
            color: var(--text-secondary);
            font-size: 12px;
        }

        /* Image Enhancement Panel */
        .enhance-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(20px);
            padding: 16px;
            border-radius: 14px;
            border: 1px solid var(--border);
            display: none;
            min-width: 220px;
        }
        .enhance-panel.active {
            display: block;
        }
        .enhance-title {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-secondary);
        }
        .enhance-slider {
            margin-bottom: 12px;
        }
        .enhance-slider label {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 6px;
        }
        .enhance-slider input {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: var(--bg-tertiary);
            outline: none;
            -webkit-appearance: none;
        }
        .enhance-slider input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
        }

        /* Quick Analyze Button */
        .quick-analyze-bar {
            padding: 16px 20px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
            align-items: center;
        }
        .quick-input {
            flex: 1;
            padding: 14px 18px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
            outline: none;
            transition: all 0.2s;
        }
        .quick-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }
        .quick-input::placeholder {
            color: var(--text-muted);
        }
        .analyze-btn {
            padding: 14px 28px;
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--accent-glow);
        }
        .analyze-btn:disabled {
            opacity: 0.5;
            transform: none;
            box-shadow: none;
        }
        .analyze-btn:active {
            transform: translateY(0);
        }

        /* Right Panel - Results */
        .right-panel {
            background: var(--bg-secondary);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Results Header */
        .results-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .results-title {
            font-size: 14px;
            font-weight: 600;
        }
        .results-actions {
            display: flex;
            gap: 8px;
        }
        .results-action-btn {
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        .results-action-btn:hover {
            background: var(--accent);
            color: white;
        }

        /* Quick Actions */
        .quick-actions {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .quick-action-btn {
            padding: 8px 14px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 20px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .quick-action-btn:hover {
            border-color: var(--accent);
            color: var(--text-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        /* Results Content */
        .results-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        .results-empty {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }
        .results-empty-icon {
            font-size: 50px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Analysis Result */
        .analysis-result {
            margin-bottom: 24px;
        }
        .result-section {
            margin-bottom: 20px;
        }
        .result-section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }
        .result-section-icon {
            width: 32px;
            height: 32px;
            background: rgba(99, 102, 241, 0.15);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        .result-section-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--accent);
        }
        .result-section-content {
            font-size: 14px;
            line-height: 1.7;
            color: var(--text-secondary);
        }
        .result-section-content p {
            margin-bottom: 12px;
        }
        .result-section-content strong {
            color: var(--text-primary);
        }
        .result-section-content code {
            background: var(--bg-tertiary);
            padding: 3px 8px;
            border-radius: 6px;
            font-family: 'Fira Code', monospace;
            font-size: 13px;
            color: #a5f3fc;
        }
        .result-section-content pre {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            overflow-x: auto;
            margin: 12px 0;
        }
        .result-section-content pre code {
            background: none;
            padding: 0;
        }
        .result-section-content ul, .result-section-content ol {
            margin: 12px 0;
            padding-left: 24px;
        }
        .result-section-content li {
            margin-bottom: 8px;
        }

        /* Tags */
        .result-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        .result-tag {
            padding: 6px 12px;
            background: rgba(99, 102, 241, 0.15);
            border-radius: 20px;
            font-size: 12px;
            color: var(--accent);
        }

        /* Confidence Meter */
        .confidence-meter {
            margin-top: 16px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 10px;
        }
        .confidence-label {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        .confidence-bar {
            height: 6px;
            background: var(--bg-primary);
            border-radius: 3px;
            overflow: hidden;
        }
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--success));
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        /* Streaming Indicator */
        .streaming-indicator {
            display: none;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 12px;
            margin-bottom: 16px;
        }
        .streaming-indicator.active {
            display: flex;
        }
        .streaming-dots {
            display: flex;
            gap: 4px;
        }
        .streaming-dots span {
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
            animation: bounce 1.4s ease-in-out infinite;
        }
        .streaming-dots span:nth-child(2) { animation-delay: 0.2s; }
        .streaming-dots span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-8px); }
        }
        .streaming-text {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Fullscreen Modal */
        .fullscreen-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .fullscreen-modal.active {
            display: flex;
        }
        .fullscreen-modal img {
            max-width: 95%;
            max-height: 95%;
            object-fit: contain;
        }
        .fullscreen-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .fullscreen-close:hover {
            background: var(--danger);
        }

        /* Camera Modal */
        .camera-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 20px;
        }
        .camera-modal.active {
            display: flex;
        }
        #cameraFeed {
            max-width: 90%;
            max-height: 70vh;
            border-radius: 16px;
        }
        .camera-controls {
            display: flex;
            gap: 16px;
        }
        .camera-btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .camera-capture {
            background: var(--accent);
            color: white;
        }
        .camera-cancel {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            padding: 14px 24px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
            z-index: 1001;
            opacity: 0;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        .toast.success { border-color: var(--success); }
        .toast.error { border-color: var(--danger); }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.25); }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 280px 1fr 320px;
            }
        }
        @media (max-width: 900px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            .left-panel, .right-panel {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-animation"></div>

    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon">üî¨</div>
            <span>Ultra Vision AI</span>
        </div>
        <div class="header-controls">
            <select class="model-select" id="modelSelect">
                <option value="claude-opus-4-5">üèÜ Claude Opus 4.5 (Best)</option>
                <option value="claude-sonnet-4-5">Claude Sonnet 4.5</option>
                <option value="claude-sonnet-4">Claude Sonnet 4</option>
                <option value="claude-opus-4">Claude Opus 4</option>
                <option value="claude-haiku-4-5">‚ö° Haiku 4.5 (Fast)</option>
            </select>
            <button class="header-btn" onclick="clearAll()">üóëÔ∏è Clear All</button>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="main-layout">
        <!-- Left Panel -->
        <aside class="left-panel">
            <!-- Upload Section -->
            <div class="panel-section">
                <div class="panel-section-header">
                    <span class="panel-section-title">üìÅ Upload Image</span>
                </div>
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">üñºÔ∏è</div>
                    <div class="upload-text">Drop image here or click</div>
                    <div class="upload-subtext">PNG, JPG, GIF, WebP ‚Ä¢ Max 20MB</div>
                    <div class="upload-methods">
                        <button class="upload-method-btn" onclick="event.stopPropagation(); toggleUrlInput()">üîó URL</button>
                        <button class="upload-method-btn" onclick="event.stopPropagation(); openCamera()">üì∑ Camera</button>
                    </div>
                </div>
                <div class="url-input-container" id="urlInputContainer">
                    <input type="text" class="url-input" id="urlInput" placeholder="Paste image URL...">
                    <button class="url-submit" onclick="loadImageFromUrl()">Load</button>
                </div>
                <input type="file" id="fileInput" accept="image/*" multiple hidden>
            </div>

            <!-- Analysis Modes -->
            <div class="panel-section">
                <div class="panel-section-header">
                    <span class="panel-section-title">üéØ Analysis Mode</span>
                </div>
                <div class="modes-grid">
                    <button class="mode-btn active" data-mode="ultra">
                        <span class="mode-btn-icon">üß†</span>Ultra
                    </button>
                    <button class="mode-btn" data-mode="ocr">
                        <span class="mode-btn-icon">üìù</span>OCR
                    </button>
                    <button class="mode-btn" data-mode="code">
                        <span class="mode-btn-icon">üíª</span>Code
                    </button>
                    <button class="mode-btn" data-mode="objects">
                        <span class="mode-btn-icon">üè∑Ô∏è</span>Objects
                    </button>
                    <button class="mode-btn" data-mode="faces">
                        <span class="mode-btn-icon">üë§</span>Faces
                    </button>
                    <button class="mode-btn" data-mode="colors">
                        <span class="mode-btn-icon">üé®</span>Colors
                    </button>
                    <button class="mode-btn" data-mode="art">
                        <span class="mode-btn-icon">üñºÔ∏è</span>Art
                    </button>
                    <button class="mode-btn" data-mode="technical">
                        <span class="mode-btn-icon">‚öôÔ∏è</span>Technical
                    </button>
                    <button class="mode-btn" data-mode="document">
                        <span class="mode-btn-icon">üìÑ</span>Document
                    </button>
                    <button class="mode-btn" data-mode="medical">
                        <span class="mode-btn-icon">üè•</span>Medical
                    </button>
                    <button class="mode-btn" data-mode="food">
                        <span class="mode-btn-icon">üçï</span>Food
                    </button>
                    <button class="mode-btn" data-mode="nature">
                        <span class="mode-btn-icon">üåø</span>Nature
                    </button>
                    <button class="mode-btn" data-mode="product">
                        <span class="mode-btn-icon">üì¶</span>Product
                    </button>
                    <button class="mode-btn" data-mode="meme">
                        <span class="mode-btn-icon">üòÇ</span>Meme
                    </button>
                    <button class="mode-btn" data-mode="compare">
                        <span class="mode-btn-icon">‚öñÔ∏è</span>Compare
                    </button>
                </div>
            </div>

            <!-- Image Queue -->
            <div class="panel-section" style="flex: 1; overflow: hidden; display: flex; flex-direction: column;">
                <div class="panel-section-header">
                    <span class="panel-section-title">üñºÔ∏è Images (<span id="queueCount">0</span>)</span>
                </div>
                <div class="image-queue" id="imageQueue">
                    <div class="queue-empty">
                        <p>No images uploaded yet</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Center Panel -->
        <main class="center-panel">
            <!-- Image Viewer -->
            <div class="image-viewer" id="imageViewer">
                <div class="viewer-placeholder" id="viewerPlaceholder">
                    <div class="viewer-placeholder-icon">üî¨</div>
                    <div class="viewer-placeholder-text">Upload an image to analyze</div>
                    <div class="viewer-placeholder-hint">Drag & drop, paste, or click to upload</div>
                </div>
                <div class="main-image-container" id="mainImageContainer">
                    <img id="mainImage" alt="Main Image">
                </div>
                <div class="image-toolbar" id="imageToolbar">
                    <button class="toolbar-btn" onclick="zoomImage(-0.2)" title="Zoom Out">‚ûñ</button>
                    <div class="toolbar-zoom">
                        <span id="zoomLevel">100%</span>
                    </div>
                    <button class="toolbar-btn" onclick="zoomImage(0.2)" title="Zoom In">‚ûï</button>
                    <div class="toolbar-separator"></div>
                    <button class="toolbar-btn" onclick="rotateImage(-90)" title="Rotate Left">‚Ü™Ô∏è</button>
                    <button class="toolbar-btn" onclick="rotateImage(90)" title="Rotate Right">‚Ü©Ô∏è</button>
                    <div class="toolbar-separator"></div>
                    <button class="toolbar-btn" onclick="toggleEnhance()" title="Enhance">‚ú®</button>
                    <button class="toolbar-btn" onclick="openFullscreen()" title="Fullscreen">‚õ∂</button>
                </div>

                <!-- Enhancement Panel -->
                <div class="enhance-panel" id="enhancePanel">
                    <div class="enhance-title">üé® Image Adjustments</div>
                    <div class="enhance-slider">
                        <label><span>Brightness</span><span id="brightnessVal">100%</span></label>
                        <input type="range" min="50" max="150" value="100" id="brightness" oninput="applyEnhance()">
                    </div>
                    <div class="enhance-slider">
                        <label><span>Contrast</span><span id="contrastVal">100%</span></label>
                        <input type="range" min="50" max="150" value="100" id="contrast" oninput="applyEnhance()">
                    </div>
                    <div class="enhance-slider">
                        <label><span>Saturation</span><span id="saturationVal">100%</span></label>
                        <input type="range" min="0" max="200" value="100" id="saturation" oninput="applyEnhance()">
                    </div>
                    <div class="enhance-slider">
                        <label><span>Sharpness</span><span id="sharpnessVal">0%</span></label>
                        <input type="range" min="0" max="100" value="0" id="sharpness" oninput="applyEnhance()">
                    </div>
                </div>
            </div>

            <!-- Quick Analyze Bar -->
            <div class="quick-analyze-bar">
                <input type="text" class="quick-input" id="customPrompt" placeholder="Ask anything about this image... (or just hit Analyze)">
                <button class="analyze-btn" id="analyzeBtn" onclick="analyze()">
                    üöÄ Analyze
                </button>
            </div>
        </main>

        <!-- Right Panel -->
        <aside class="right-panel">
            <div class="results-header">
                <span class="results-title">üìä Analysis Results</span>
                <div class="results-actions">
                    <button class="results-action-btn" onclick="copyResults()" title="Copy">üìã</button>
                    <button class="results-action-btn" onclick="downloadResults()" title="Download">üíæ</button>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions" id="quickActions">
                <button class="quick-action-btn" data-prompt="Describe everything in extreme detail">üîç Ultra Detail</button>
                <button class="quick-action-btn" data-prompt="Extract all text with perfect accuracy">üìù Extract Text</button>
                <button class="quick-action-btn" data-prompt="List every object with locations">üè∑Ô∏è All Objects</button>
                <button class="quick-action-btn" data-prompt="Analyze colors, composition, and style">üé® Visual Style</button>
            </div>

            <!-- Results Content -->
            <div class="results-content" id="resultsContent">
                <!-- Streaming Indicator -->
                <div class="streaming-indicator" id="streamingIndicator">
                    <div class="streaming-dots">
                        <span></span><span></span><span></span>
                    </div>
                    <span class="streaming-text">Analyzing image...</span>
                </div>

                <div class="results-empty" id="resultsEmpty">
                    <div class="results-empty-icon">üìä</div>
                    <p>Analysis results will appear here</p>
                </div>

                <div class="analysis-result" id="analysisResult" style="display: none;">
                    <!-- Results will be inserted here -->
                </div>
            </div>
        </aside>
    </div>

    <!-- Fullscreen Modal -->
    <div class="fullscreen-modal" id="fullscreenModal">
        <button class="fullscreen-close" onclick="closeFullscreen()">‚úï</button>
        <img id="fullscreenImage" alt="Fullscreen">
    </div>

    <!-- Camera Modal -->
    <div class="camera-modal" id="cameraModal">
        <video id="cameraFeed" autoplay playsinline></video>
        <div class="camera-controls">
            <button class="camera-btn camera-capture" onclick="capturePhoto()">üì∏ Capture</button>
            <button class="camera-btn camera-cancel" onclick="closeCamera()">Cancel</button>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // ==================== STATE ====================
        let images = [];
        let selectedIndex = -1;
        let currentMode = 'ultra';
        let currentZoom = 1;
        let currentRotation = 0;
        let lastResult = '';
        let cameraStream = null;
        let isAnalyzing = false;

        // ==================== DOM ====================
        const $ = id => document.getElementById(id);
        const uploadZone = $('uploadZone');
        const fileInput = $('fileInput');
        const imageQueue = $('imageQueue');
        const queueCount = $('queueCount');
        const mainImage = $('mainImage');
        const mainImageContainer = $('mainImageContainer');
        const viewerPlaceholder = $('viewerPlaceholder');
        const imageToolbar = $('imageToolbar');
        const zoomLevel = $('zoomLevel');
        const customPrompt = $('customPrompt');
        const analyzeBtn = $('analyzeBtn');
        const resultsContent = $('resultsContent');
        const resultsEmpty = $('resultsEmpty');
        const analysisResult = $('analysisResult');
        const streamingIndicator = $('streamingIndicator');
        const modelSelect = $('modelSelect');
        const enhancePanel = $('enhancePanel');

        // ==================== ULTRA PROMPTS ====================
        const ULTRA_PROMPTS = {
            ultra: `You are an ULTRA ADVANCED vision AI. Analyze this image with MAXIMUM detail and accuracy.

## COMPREHENSIVE ANALYSIS REQUIRED:

### 1. üîç OVERVIEW
- Main subject/scene identification
- Image type (photo, screenshot, illustration, etc.)
- Overall context and setting

### 2. üè∑Ô∏è DETAILED OBJECT DETECTION
List EVERY visible object with:
- Object name
- Location (top-left, center, bottom-right, etc.)
- Size (small, medium, large relative to image)
- Color/appearance
- Condition/state

### 3. üë§ PEOPLE/FACES (if present)
- Number of people
- Approximate ages
- Gender presentation
- Expressions/emotions
- Clothing description
- Activities/poses
- Relationships between people

### 4. üìù TEXT EXTRACTION (if any)
- Extract ALL visible text verbatim
- Note text location, size, font style
- Translate if not English

### 5. üé® VISUAL ANALYSIS
- Color palette (list dominant colors with hex codes if possible)
- Lighting (natural, artificial, direction, quality)
- Composition (rule of thirds, symmetry, leading lines)
- Depth of field and focus
- Image quality assessment

### 6. üåç CONTEXT & METADATA
- Estimated location/setting
- Time of day (if determinable)
- Season/weather (if outdoor)
- Cultural context
- Era/time period

### 7. üí° INSIGHTS & OBSERVATIONS
- Unusual or notable elements
- Hidden details others might miss
- Possible story/narrative
- Mood/atmosphere

### 8. üè∑Ô∏è AUTO-TAGS
Generate 10-15 relevant tags for this image.

### 9. üìä CONFIDENCE SCORE
Rate your confidence in this analysis (0-100%).

BE EXTREMELY THOROUGH. MISS NOTHING.`,

            ocr: `You are an EXPERT OCR AI. Extract ALL text from this image with PERFECT accuracy.

## TEXT EXTRACTION REQUIREMENTS:

### 1. COMPLETE TEXT EXTRACTION
- Extract EVERY piece of text visible
- Maintain original formatting (line breaks, spacing)
- Preserve capitalization exactly
- Include punctuation

### 2. TEXT ORGANIZATION
Present text in this format:
- **Headers/Titles**: [text]
- **Body Text**: [text]
- **Labels/Captions**: [text]
- **Small Print**: [text]
- **Watermarks**: [text]
- **Handwritten**: [text]

### 3. TEXT PROPERTIES
For each text block note:
- Font style (serif, sans-serif, handwritten, etc.)
- Size (large, medium, small)
- Color
- Location in image
- Orientation (horizontal, vertical, angled)

### 4. LANGUAGE DETECTION
- Identify all languages present
- Provide translation to English if needed

### 5. CONFIDENCE LEVEL
- Mark any uncertain characters with [?]
- Rate overall OCR confidence

BE 100% ACCURATE. MISS NO TEXT.`,

            code: `You are an EXPERT CODE ANALYZER. Analyze this code image with MAXIMUM detail.

## CODE ANALYSIS REQUIREMENTS:

### 1. FULL CODE EXTRACTION
\`\`\`[detected_language]
[Extract complete code exactly as shown]
\`\`\`

### 2. LANGUAGE & FRAMEWORK
- Programming language(s) detected
- Frameworks/libraries used
- Version indicators if visible

### 3. CODE EXPLANATION
- Purpose of the code
- Step-by-step logic explanation
- Key functions/methods explained
- Data structures used

### 4. CODE QUALITY ASSESSMENT
- Syntax correctness
- Best practices followed/violated
- Potential bugs or issues
- Performance considerations
- Security concerns

### 5. IMPROVEMENTS
- Suggested fixes for any issues
- Optimization recommendations
- Better alternatives if applicable

### 6. RELATED INFO
- What this code might be part of
- Common use cases
- Dependencies needed

EXTRACT EVERY CHARACTER PERFECTLY.`,

            objects: `You are an EXPERT OBJECT DETECTION AI. Identify EVERY object in this image.

## OBJECT DETECTION REQUIREMENTS:

Create a comprehensive list of ALL objects:

| # | Object | Location | Size | Color | Details |
|---|--------|----------|------|-------|---------|
| 1 | [name] | [position] | [size] | [color] | [details] |

### FOR EACH OBJECT PROVIDE:
1. **Identification**: Specific name (not just "furniture" but "oak dining chair")
2. **Location**: Position in image (top-left, center, etc.)
3. **Bounding Box**: Approximate % of image
4. **Primary Color**: Main color
5. **Material**: If identifiable (wood, metal, plastic, etc.)
6. **Condition**: New, used, damaged, etc.
7. **Brand/Model**: If visible
8. **Quantity**: How many of this object
9. **Relationship**: Near what other objects

### CATEGORIES TO CHECK:
- Furniture
- Electronics
- Clothing/Accessories
- Food/Beverages
- Plants/Nature
- Vehicles
- Buildings/Architecture
- People/Body parts
- Animals
- Text/Signs
- Tools/Equipment
- Art/Decorations

DETECT EVERYTHING. MISS NOTHING.`,

            faces: `You are an EXPERT FACE ANALYSIS AI. Analyze all faces in this image.

## FACE ANALYSIS REQUIREMENTS:

### FOR EACH PERSON:

**Person 1:**
- **Position**: Location in image
- **Age Estimate**: Approximate age range
- **Gender Presentation**: How they present
- **Expression**: Detailed emotion analysis
  - Primary emotion
  - Secondary emotions
  - Intensity (subtle, moderate, strong)
- **Eye Details**:
  - Color
  - Direction of gaze
  - Open/closed
- **Facial Features**:
  - Face shape
  - Distinctive features
- **Hair**:
  - Color
  - Style
  - Length
- **Skin**:
  - Complexion
  - Any visible details
- **Accessories**:
  - Glasses
  - Jewelry
  - Makeup
- **Pose**: Head angle and position

### GROUP DYNAMICS (if multiple people):
- Relationships between individuals
- Group mood
- Interactions

ANALYZE IN MAXIMUM DETAIL.`,

            colors: `You are an EXPERT COLOR ANALYST. Analyze the color palette of this image.

## COLOR ANALYSIS REQUIREMENTS:

### 1. DOMINANT COLORS
List top 10 colors:
| Rank | Color Name | Hex Code | RGB | % of Image | Location |
|------|------------|----------|-----|------------|----------|

### 2. COLOR HARMONY
- Type (complementary, analogous, triadic, etc.)
- Effectiveness
- Emotional impact

### 3. COLOR PSYCHOLOGY
- Mood conveyed by colors
- Emotional associations
- Cultural significance

### 4. LIGHTING ANALYSIS
- Color temperature (warm/cool)
- Light source color
- Shadow colors

### 5. SATURATION & VALUE
- Overall saturation level
- Value distribution (lights/darks)
- Contrast ratio

### 6. COLOR RECOMMENDATIONS
- Colors that would complement
- Alternative palettes
- Adjustments for improvement

PROVIDE PRECISE HEX CODES.`,

            art: `You are an EXPERT ART CRITIC & ANALYST. Provide a professional critique.

## ART ANALYSIS REQUIREMENTS:

### 1. ARTWORK IDENTIFICATION
- Art form (painting, digital, photo, etc.)
- Style/movement
- Medium (oil, watercolor, digital, etc.)
- Estimated era/period

### 2. COMPOSITION ANALYSIS
- Rule of thirds adherence
- Focal points
- Visual flow/movement
- Balance (symmetrical/asymmetrical)
- Negative space usage

### 3. TECHNICAL EXECUTION
- Skill level apparent
- Technique mastery
- Brushwork/strokes (if applicable)
- Precision vs. looseness

### 4. COLOR & LIGHT
- Palette choices
- Color theory application
- Light source and rendering
- Atmosphere created

### 5. SYMBOLISM & MEANING
- Apparent themes
- Hidden symbols
- Cultural references
- Emotional narrative

### 6. ARTISTIC INFLUENCES
- Similar artists/works
- Movement connections
- Historical context

### 7. PROFESSIONAL CRITIQUE
- Strengths
- Areas for improvement
- Overall assessment
- Gallery/market viability

ANALYZE LIKE A MUSEUM CURATOR.`,

            technical: `You are an EXPERT TECHNICAL DIAGRAM ANALYZER.

## TECHNICAL ANALYSIS REQUIREMENTS:

### 1. DIAGRAM TYPE
- Schematic/circuit
- Flowchart
- UML diagram
- Architecture diagram
- Mechanical drawing
- Other technical drawing

### 2. COMPONENT IDENTIFICATION
List all components:
| Symbol | Name | Function | Connections |
|--------|------|----------|-------------|

### 3. SYSTEM EXPLANATION
- Overall purpose
- How it works step-by-step
- Input ‚Üí Processing ‚Üí Output

### 4. TECHNICAL SPECIFICATIONS
- Any values/measurements shown
- Units used
- Standards followed

### 5. CONNECTIONS & FLOW
- How components connect
- Data/signal/power flow
- Dependencies

### 6. APPLICATIONS
- What this system is used for
- Industry/field
- Common implementations

EXPLAIN FOR BOTH EXPERTS AND BEGINNERS.`,

            document: `You are an EXPERT DOCUMENT ANALYZER.

## DOCUMENT ANALYSIS REQUIREMENTS:

### 1. DOCUMENT TYPE
- Form, letter, contract, receipt, etc.
- Official or informal
- Template or custom

### 2. COMPLETE TEXT EXTRACTION
[Extract ALL text maintaining structure]

### 3. KEY INFORMATION
- **Parties involved**: Names, organizations
- **Dates**: All dates mentioned
- **Numbers**: Amounts, IDs, references
- **Addresses**: Any locations
- **Signatures**: Present or missing

### 4. STRUCTURE ANALYSIS
- Sections identified
- Headers and organization
- Important vs. fine print

### 5. SUMMARY
- Main purpose of document
- Key points (bullet list)
- Action items if any

### 6. VERIFICATION NOTES
- Any red flags
- Missing information
- Authenticity indicators

MISS NO DETAIL.`,

            medical: `‚ö†Ô∏è DISCLAIMER: For educational purposes only. Not medical advice.

## MEDICAL IMAGE ANALYSIS:

### 1. IMAGE TYPE
- X-ray, MRI, CT, ultrasound, photo, etc.
- Body region shown
- View angle/orientation

### 2. ANATOMICAL STRUCTURES
- Identify all visible anatomy
- Label major structures
- Note any variations

### 3. OBSERVATIONS
- Normal findings
- Abnormal findings (if any)
- Areas of interest

### 4. IMAGE QUALITY
- Diagnostic quality
- Technical factors
- Limitations

### 5. EDUCATIONAL NOTES
- What this type of image shows
- Common findings in such images
- Learning points

‚ö†Ô∏è ALWAYS CONSULT HEALTHCARE PROFESSIONALS.`,

            food: `You are an EXPERT FOOD & CULINARY ANALYST.

## FOOD ANALYSIS REQUIREMENTS:

### 1. DISH IDENTIFICATION
- Name of dish(es)
- Cuisine type
- Course category

### 2. INGREDIENTS DETECTED
List all visible ingredients:
| Ingredient | Amount | Preparation | Location |
|------------|--------|-------------|----------|

### 3. COOKING METHODS
- How was this prepared?
- Cooking techniques used
- Skill level required

### 4. PRESENTATION ANALYSIS
- Plating style
- Garnishes
- Visual appeal rating

### 5. NUTRITIONAL ESTIMATE
- Approximate calories
- Macro breakdown (carbs, protein, fat)
- Dietary considerations (vegan, gluten-free, etc.)

### 6. RECIPE POTENTIAL
- Could this be recreated?
- Key steps to make
- Difficulty level

ANALYZE LIKE A MASTER CHEF.`,

            nature: `You are an EXPERT NATURALIST & BIOLOGIST.

## NATURE ANALYSIS REQUIREMENTS:

### 1. SCENE IDENTIFICATION
- Ecosystem type
- Geographic region
- Time of day/season

### 2. SPECIES IDENTIFICATION
For each organism:
| Type | Common Name | Scientific Name | Details |
|------|-------------|-----------------|---------|

### 3. PLANTS
- Species identification
- Health assessment
- Growth stage

### 4. ANIMALS
- Species identification
- Behavior observed
- Approximate age/gender

### 5. ECOLOGICAL ANALYSIS
- Habitat characteristics
- Food web connections
- Environmental indicators

### 6. WEATHER & CLIMATE
- Current conditions
- Climate indicators
- Seasonal signs

IDENTIFY EVERY SPECIES POSSIBLE.`,

            product: `You are an EXPERT PRODUCT ANALYST.

## PRODUCT ANALYSIS REQUIREMENTS:

### 1. PRODUCT IDENTIFICATION
- Product name/type
- Brand (if visible)
- Model/variant

### 2. PHYSICAL DESCRIPTION
- Dimensions (estimated)
- Colors
- Materials
- Weight class

### 3. FEATURES
- Visible features
- Buttons/controls
- Ports/connections
- Included accessories

### 4. CONDITION
- New or used
- Any damage/wear
- Completeness

### 5. MARKET ANALYSIS
- Approximate price range
- Target audience
- Competitor comparisons

### 6. USE CASES
- Primary purpose
- Secondary uses
- Setup requirements

ANALYZE LIKE A PRODUCT REVIEWER.`,

            meme: `You are an EXPERT MEME ANALYST & INTERNET CULTURE SPECIALIST.

## MEME ANALYSIS REQUIREMENTS:

### 1. MEME IDENTIFICATION
- Meme template name
- Origin (if known)
- Era (when popular)

### 2. TEXT EXTRACTION
- Top text
- Bottom text
- Any additional text

### 3. HUMOR ANALYSIS
- Type of humor
- Setup ‚Üí Punchline structure
- Cultural references

### 4. CONTEXT
- What situation is being referenced
- Target audience
- Relatability factor

### 5. VIRALITY ASSESSMENT
- Shareability (1-10)
- Originality (1-10)
- Humor effectiveness (1-10)

### 6. EXPLANATION
For someone who doesn't get it:
[Clear explanation of the joke]

BE THE MEME LORD.`,

            compare: `You are an EXPERT IMAGE COMPARISON ANALYST.

## COMPARISON ANALYSIS REQUIREMENTS:

### 1. IMAGE OVERVIEW
For each image:
- Subject
- Type
- Key characteristics

### 2. SIMILARITIES
- Matching elements
- Shared characteristics
- Common themes

### 3. DIFFERENCES
| Aspect | Image 1 | Image 2 |
|--------|---------|---------|
[Detailed comparison table]

### 4. QUALITY COMPARISON
- Resolution
- Clarity
- Composition
- Lighting

### 5. CHANGE DETECTION (if before/after)
- What changed
- What stayed same
- Progression/regression

### 6. VERDICT
- Which is better for what purpose
- Recommendations

COMPARE EVERY DETAIL.`
        };

        // ==================== QUICK ACTIONS PER MODE ====================
        const QUICK_ACTIONS = {
            ultra: [
                { text: 'üîç Ultra Detail', prompt: 'Describe everything in EXTREME detail' },
                { text: 'üè∑Ô∏è All Objects', prompt: 'List every single object visible' },
                { text: 'üìù Extract Text', prompt: 'Extract all text with perfect accuracy' },
                { text: 'üé® Visual Style', prompt: 'Analyze colors, composition, lighting' }
            ],
            ocr: [
                { text: 'üìù Full Extract', prompt: 'Extract ALL text maintaining format' },
                { text: 'üìã As List', prompt: 'Extract text as a structured list' },
                { text: 'üåê Translate', prompt: 'Extract and translate to English' },
                { text: '‚úçÔ∏è Handwriting', prompt: 'Focus on handwritten text' }
            ],
            code: [
                { text: 'üíª Extract Code', prompt: 'Extract the complete code' },
                { text: 'üìñ Explain', prompt: 'Explain what this code does' },
                { text: 'üêõ Find Bugs', prompt: 'Find any bugs or issues' },
                { text: '‚ö° Optimize', prompt: 'Suggest optimizations' }
            ],
            objects: [
                { text: 'üè∑Ô∏è List All', prompt: 'List every object with locations' },
                { text: 'üìä Count', prompt: 'Count all objects by category' },
                { text: 'üéØ Main Subject', prompt: 'Focus on the main subject' },
                { text: 'üîç Hidden Items', prompt: 'Find hidden or small objects' }
            ]
        };

        // ==================== FILE HANDLING ====================
        function handleFiles(files) {
            Array.from(files).forEach(async file => {
                if (file.type.startsWith('image/')) {
                    const base64 = await fileToBase64(file);
                    addImage({
                        id: Date.now() + Math.random(),
                        name: file.name,
                        size: formatSize(file.size),
                        base64: base64,
                        analyzed: false
                    });
                }
            });
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function formatSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        function addImage(img) {
            images.push(img);
            renderQueue();
            if (images.length === 1) selectImage(0);
            showToast('Image added!', 'success');
        }

        // ==================== QUEUE MANAGEMENT ====================
        function renderQueue() {
            queueCount.textContent = images.length;
            
            if (images.length === 0) {
                imageQueue.innerHTML = '<div class="queue-empty"><p>No images uploaded yet</p></div>';
                return;
            }

            imageQueue.innerHTML = images.map((img, i) => `
                <div class="queue-item ${i === selectedIndex ? 'selected' : ''}" onclick="selectImage(${i})">
                    <img src="${img.base64}" alt="${img.name}" class="queue-item-thumb">
                    <div class="queue-item-info">
                        <div class="queue-item-name">${img.name}</div>
                        <div class="queue-item-meta">${img.size}</div>
                    </div>
                    <span class="queue-item-status ${img.analyzed ? 'analyzed' : ''}">${img.analyzed ? '‚úì' : '‚óã'}</span>
                    <button class="queue-item-remove" onclick="event.stopPropagation(); removeImage(${i})">‚úï</button>
                </div>
            `).join('');
        }

        function selectImage(index) {
            selectedIndex = index;
            const img = images[index];
            
            mainImage.src = img.base64;
            mainImageContainer.classList.add('active');
            viewerPlaceholder.style.display = 'none';
            imageToolbar.classList.add('active');
            
            currentZoom = 1;
            currentRotation = 0;
            applyTransforms();
            resetEnhance();
            renderQueue();
        }

        function removeImage(index) {
            images.splice(index, 1);
            
            if (images.length === 0) {
                selectedIndex = -1;
                mainImageContainer.classList.remove('active');
                viewerPlaceholder.style.display = 'block';
                imageToolbar.classList.remove('active');
            } else if (selectedIndex >= images.length) {
                selectImage(images.length - 1);
            } else if (selectedIndex === index) {
                selectImage(Math.max(0, index - 1));
            }
            
            renderQueue();
        }

        function clearAll() {
            images = [];
            selectedIndex = -1;
            mainImageContainer.classList.remove('active');
            viewerPlaceholder.style.display = 'block';
            imageToolbar.classList.remove('active');
            analysisResult.style.display = 'none';
            resultsEmpty.style.display = 'block';
            renderQueue();
            showToast('Cleared all images', 'success');
        }

        // ==================== IMAGE CONTROLS ====================
        function zoomImage(delta) {
            currentZoom = Math.max(0.25, Math.min(4, currentZoom + delta));
            applyTransforms();
            zoomLevel.textContent = Math.round(currentZoom * 100) + '%';
        }

        function rotateImage(degrees) {
            currentRotation = (currentRotation + degrees) % 360;
            applyTransforms();
        }

        function applyTransforms() {
            mainImage.style.transform = `scale(${currentZoom}) rotate(${currentRotation}deg)`;
        }

        function toggleEnhance() {
            enhancePanel.classList.toggle('active');
        }

        function applyEnhance() {
            const brightness = $('brightness').value;
            const contrast = $('contrast').value;
            const saturation = $('saturation').value;
            const sharpness = $('sharpness').value;

            $('brightnessVal').textContent = brightness + '%';
            $('contrastVal').textContent = contrast + '%';
            $('saturationVal').textContent = saturation + '%';
            $('sharpnessVal').textContent = sharpness + '%';

            mainImage.style.filter = `
                brightness(${brightness}%) 
                contrast(${contrast}%) 
                saturate(${saturation}%)
                ${sharpness > 0 ? `url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg"><filter id="sharp"><feConvolveMatrix kernelMatrix="0 -1 0 -1 ${5 + sharpness/10} -1 0 -1 0"/></filter></svg>#sharp')` : ''}
            `;
        }

        function resetEnhance() {
            $('brightness').value = 100;
            $('contrast').value = 100;
            $('saturation').value = 100;
            $('sharpness').value = 0;
            applyEnhance();
        }

        // ==================== FULLSCREEN ====================
        function openFullscreen() {
            if (selectedIndex >= 0) {
                $('fullscreenImage').src = images[selectedIndex].base64;
                $('fullscreenModal').classList.add('active');
            }
        }

        function closeFullscreen() {
            $('fullscreenModal').classList.remove('active');
        }

        // ==================== CAMERA ====================
        async function openCamera() {
            try {
                cameraStream = await navigator.mediaDevices.getUserMedia({ video: true });
                $('cameraFeed').srcObject = cameraStream;
                $('cameraModal').classList.add('active');
            } catch (error) {
                showToast('Camera access denied', 'error');
            }
        }

        function capturePhoto() {
            const video = $('cameraFeed');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            const base64 = canvas.toDataURL('image/jpeg');
            addImage({
                id: Date.now(),
                name: 'Camera_' + new Date().toISOString().slice(0,19).replace(/:/g, '-') + '.jpg',
                size: 'Camera capture',
                base64: base64,
                analyzed: false
            });
            
            closeCamera();
        }

        function closeCamera() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
            $('cameraModal').classList.remove('active');
        }

        // ==================== URL IMPORT ====================
        function toggleUrlInput() {
            $('urlInputContainer').classList.toggle('active');
        }

        async function loadImageFromUrl() {
            const url = $('urlInput').value.trim();
            if (!url) return;

            try {
                showToast('Loading image...', 'success');
                const response = await fetch(url);
                const blob = await response.blob();
                const base64 = await fileToBase64(blob);
                
                addImage({
                    id: Date.now(),
                    name: url.split('/').pop() || 'URL Image',
                    size: formatSize(blob.size),
                    base64: base64,
                    analyzed: false
                });
                
                $('urlInput').value = '';
                toggleUrlInput();
            } catch (error) {
                showToast('Failed to load image from URL', 'error');
            }
        }

        // ==================== ANALYSIS ====================
        async function analyze() {
            if (images.length === 0) {
                showToast('Please upload an image first', 'error');
                return;
            }

            if (isAnalyzing) return;

            isAnalyzing = true;
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = '‚è≥ Analyzing...';
            
            resultsEmpty.style.display = 'none';
            analysisResult.style.display = 'block';
            analysisResult.innerHTML = '';
            streamingIndicator.classList.add('active');

            const userPrompt = customPrompt.value.trim();
            const modePrompt = ULTRA_PROMPTS[currentMode] || ULTRA_PROMPTS.ultra;
            const finalPrompt = userPrompt 
                ? `${modePrompt}\n\n## USER'S SPECIFIC REQUEST:\n${userPrompt}\n\nPRIORITIZE the user's request while still providing comprehensive analysis.`
                : modePrompt;

            const imagesToAnalyze = currentMode === 'compare' 
                ? images.map(img => img.base64)
                : [images[selectedIndex >= 0 ? selectedIndex : 0].base64];

            let content = [];
            imagesToAnalyze.forEach(base64 => {
                const matches = base64.match(/^data:(.+);base64,(.+)$/);
                if (matches) {
                    content.push({
                        type: 'image',
                        source: {
                            type: 'base64',
                            media_type: matches[1],
                            data: matches[2]
                        }
                    });
                }
            });
            content.push({ type: 'text', text: finalPrompt });

            try {
                const response = await puter.ai.chat(
                    [{ role: 'user', content: content }],
                    { model: modelSelect.value, stream: true }
                );

                streamingIndicator.classList.remove('active');
                let fullResponse = '';

                for await (const part of response) {
                    if (part?.text) {
                        fullResponse += part.text;
                        analysisResult.innerHTML = formatMarkdown(fullResponse);
                        resultsContent.scrollTop = resultsContent.scrollHeight;
                    }
                }

                lastResult = fullResponse;
                if (selectedIndex >= 0) {
                    images[selectedIndex].analyzed = true;
                    renderQueue();
                }

                showToast('Analysis complete!', 'success');

            } catch (error) {
                streamingIndicator.classList.remove('active');
                analysisResult.innerHTML = `<div style="color: #ef4444;">‚ùå Error: ${error.message}</div>`;
                showToast('Analysis failed', 'error');
            }

            isAnalyzing = false;
            analyzeBtn.disabled = false;
            analyzeBtn.textContent = 'üöÄ Analyze';
            customPrompt.value = '';
        }

        // ==================== MARKDOWN FORMATTING ====================
        function formatMarkdown(text) {
            if (!text) return '';
            
            // Code blocks
            text = text.replace(/```(\w*)\n?([\s\S]*?)```/g, '<pre><code class="language-$1">$2</code></pre>');
            
            // Headers
            text = text.replace(/^### (.*$)/gm, '<h4 style="color:#8b5cf6;margin:16px 0 8px;">$1</h4>');
            text = text.replace(/^## (.*$)/gm, '<h3 style="color:#6366f1;margin:20px 0 10px;">$1</h3>');
            text = text.replace(/^# (.*$)/gm, '<h2 style="color:#6366f1;margin:24px 0 12px;">$1</h2>');
            
            // Bold and italic
            text = text.replace(/\*\*\*(.*?)\*\*\*/g, '<strong><em>$1</em></strong>');
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // Inline code
            text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
            
            // Tables
            text = text.replace(/\|(.+)\|/g, (match) => {
                const cells = match.split('|').filter(c => c.trim());
                const row = cells.map(c => `<td style="padding:8px;border:1px solid #333;">${c.trim()}</td>`).join('');
                return `<tr>${row}</tr>`;
            });
            text = text.replace(/(<tr>.*<\/tr>)/gs, '<table style="border-collapse:collapse;width:100%;margin:12px 0;">$1</table>');
            
            // Lists
            text = text.replace(/^\- (.*$)/gm, '<li style="margin:4px 0;">$1</li>');
            text = text.replace(/(<li.*<\/li>)/gs, '<ul style="padding-left:20px;margin:8px 0;">$1</ul>');
            
            // Line breaks
            text = text.replace(/\n\n/g, '</p><p style="margin:12px 0;">');
            text = text.replace(/\n/g, '<br>');
            
            return `<div class="result-section-content"><p style="margin:12px 0;">${text}</p></div>`;
        }

        // ==================== RESULTS ACTIONS ====================
        function copyResults() {
            navigator.clipboard.writeText(lastResult);
            showToast('Copied to clipboard!', 'success');
        }

        function downloadResults() {
            const blob = new Blob([lastResult], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `analysis-${Date.now()}.md`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Downloaded!', 'success');
        }

        // ==================== TOAST NOTIFICATIONS ====================
        function showToast(message, type = '') {
            const toast = $('toast');
            toast.textContent = message;
            toast.className = 'toast show ' + type;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // ==================== UPDATE QUICK ACTIONS ====================
        function updateQuickActions() {
            const actions = QUICK_ACTIONS[currentMode] || QUICK_ACTIONS.ultra;
            $('quickActions').innerHTML = actions.map(a => 
                `<button class="quick-action-btn" data-prompt="${a.prompt}">${a.text}</button>`
            ).join('');
            
            document.querySelectorAll('.quick-action-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    customPrompt.value = btn.dataset.prompt;
                    analyze();
                });
            });
        }

        // ==================== EVENT LISTENERS ====================
        
        //
